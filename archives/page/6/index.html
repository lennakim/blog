<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  
  <title>归档 | Shooter</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  
    <meta name="author" content="shooter">
  
  
  <meta name="description" content="禦風而行 世而譽之而不加勸 世而非之而不加沮">
<meta property="og:type" content="website">
<meta property="og:title" content="Shooter">
<meta property="og:url" content="http://shooter.gl/archives/page/6/index.html">
<meta property="og:site_name" content="Shooter">
<meta property="og:description" content="禦風而行 世而譽之而不加勸 世而非之而不加沮">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Shooter">
<meta name="twitter:description" content="禦風而行 世而譽之而不加勸 世而非之而不加沮">
  
    <link rel="alternate" href="/atom.xml" title="Shooter" type="application/atom+xml">
  
  
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
</head>

<body>
  <div class="wrapper">
    <header id="header">
  <div class="title">
    <h1><a href="/">Shooter</a></h1>
    <p><a href="/">I am shooter</a></p>
  </div>
  <nav class="nav">
    <ul>
      
        <li><a href="/archives">Archives</a></li>
      
        <li><a href="/about">About</a></li>
      
      
        <li><a href="/atom.xml">RSS</a></li>
      
    </ul>
    <div class="clearfix"></div>
  </nav>
  <div class="clearfix"></div>
</header>
    <div class="content">




  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <a href="/tech-2014-05-07-emacs-shortcuts/">
  <time datetime="2014-05-07T09:37:07.000Z">
    2014-05-07
  </time>
</a>
    
    
  
    <h1 class="title"><a href="/tech-2014-05-07-emacs-shortcuts/">在shell中使用emacs快捷键</a></h1>
  

  </header>
  
  <div class="entry">
    
      <p>最近买了个 <a href="http://zh.wikipedia.org/wiki/Happy_Hacking_Keyboard" target="_blank" rel="external">hhkb</a> 白色无刻, 跟一般的键盘差别太大, 没有方向键, 在shell中移动光标太麻烦.</p>
<p>shell 有 <strong>editing-mode</strong>, 默认是 emacs-mode, 所以emacs快捷键在shell中生效, 故记下几个emacs快捷键.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ctrl+a &#21040;&#34892;&#39318;&#10;ctrl+e &#21040;&#34892;&#23614;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ctrl+u &#20174;&#20809;&#26631;&#22788;&#21024;&#38500;&#21040;&#34892;&#39318; #&#22312;zsh&#29615;&#22659;&#19979;&#22833;&#25928;, &#35299;&#20915;&#26041;&#27861;&#24050;&#34917;&#20805;&#10;ctrl+k &#20174;&#20809;&#26631;&#22788;&#21024;&#38500;&#21040;&#34892;&#23614;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ctrl+f &#20809;&#26631;&#21069;&#31227;&#10;ctrl+b &#20809;&#26631;&#21518;&#36864;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ctrl+p shell&#20013;&#19978;&#19968;&#20010;&#21629;&#20196;, &#25110;&#32773; &#25991;&#26412;&#20013;&#31227;&#21160;&#21040;&#19978;&#19968;&#34892;&#10;ctrl+n shell&#20013;&#19979;&#19968;&#20010;&#21629;&#20196;, &#25110;&#32773; &#25991;&#26412;&#20013;&#31227;&#21160;&#21040;&#19979;&#19968;&#34892;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ctrl+r &#24448;&#21518;&#25628;&#32034;&#21382;&#21490;&#21629;&#20196;&#10;ctrl+s &#24448;&#21069;&#25628;&#32034;&#21382;&#21490;&#21629;&#20196;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ctrl+d &#21024;&#38500;&#19968;&#20010;&#23383;&#31526;, &#21024;&#38500;&#19968;&#20010;&#23383;&#31526;, &#30456;&#24403;&#20110;&#36890;&#24120;&#30340;Delete&#38190;&#10;ctrl+h &#36864;&#26684;&#21024;&#38500;&#19968;&#20010;&#23383;&#31526;, &#30456;&#24403;&#20110;&#36890;&#24120;&#30340;Backspace&#38190;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ctrl+y &#31896;&#36148;&#10;ctrl+l &#28165;&#29702;&#23631;&#24149;, &#31867;&#20284;clear</span><br></pre></td></tr></table></figure>
<hr>
<p>补充: 2015-01-05</p>
<h3 id="解决_ctrl+u_在zsh环境下失效的问题">解决 ctrl+u 在<a href="http://www.zsh.org/" target="_blank" rel="external">zsh</a>环境下失效的问题</h3><p>按照<a href="http://stackoverflow.com/questions/3483604/which-shortcut-in-zsh-does-the-same-as-ctrl-u-in-bash" target="_blank" rel="external">which-shortcut-in-zsh-does-the-same-as-ctrl-u-in-bash</a>,<br>在<code>.zshrc</code> 文件写入 <code>bindkey \^U backward-kill-line</code> 即可.</p>
<h3 id="设置shell_editing-mode_为_vi-mode">设置shell editing-mode 为 vi-mode</h3><p>在shell中输入 <code>set -o vi</code>, 或者在shell配置文件中写入 <code>set -o vi</code>,<br>按下 Esc, 输入 hjkl 就可以在shell中移动光标了.</p>

    
  </div>
  <footer class="end-sep">
    
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <a href="/tech-2014-01-15-rails-view-best-practices/">
  <time datetime="2014-01-15T14:18:18.000Z">
    2014-01-15
  </time>
</a>
    
    
  
    <h1 class="title"><a href="/tech-2014-01-15-rails-view-best-practices/">rails 页面最佳实践</a></h1>
  

  </header>
  
  <div class="entry">
    
      <h2 id="什么是好的_view">什么是好的 view</h2><h3 id="为什么需要最佳实践？">为什么需要最佳实践？</h3><ul>
<li>项目太大，难懂</li>
<li>团队编程风格不同</li>
</ul>
<h3 id="你的_View_可能正面临的问题">你的 View 可能正面临的问题</h3><ul>
<li>Complex UI with logic UI 和代码逻辑纠缠在一起</li>
<li>Too long to maintain 代码太长难以维护</li>
<li>Low performance 性能不好</li>
<li>Security issues 容易产生安全问题</li>
</ul>
<h3 id="什么是好的代码">什么是好的代码</h3><ul>
<li>Readability 易读，容易了解</li>
<li>Flexibility 弹性，容易扩充</li>
<li>Effective 效率，写码快速</li>
<li>Maintainability 维护性，容易找到问题</li>
<li>Consistency 一致性，遵循管理无须死背</li>
<li>Testability 可测行，容易编写测试</li>
</ul>
<h2 id="18招技巧">18招技巧</h2><h3 id="No-1_Move_logic_to_helper">No.1 Move logic to helper</h3><p>BAD:</p>
<figure class="highlight erb"><table><tr><td class="code"><pre><span class="line"><span class="xml"></span>&lt;%<span class="ruby"> <span class="keyword">if</span> current_user &amp;&amp; current_user == post.user </span>%&gt;<span class="xml"></span><br><span class="line">  </span>&lt;%=<span class="ruby"> link_to(<span class="string">"Edit"</span>, edit_post_path(post))</span>%&gt;<span class="xml"></span><br><span class="line"></span>&lt;%<span class="ruby"> <span class="keyword">end</span> </span>%&gt;<span class="xml"></span></span><br></pre></td></tr></table></figure>
<p>GOOD:</p>
<figure class="highlight erb"><table><tr><td class="code"><pre><span class="line"><span class="xml"></span>&lt;%<span class="ruby"> <span class="keyword">if</span> editable?(post) </span>%&gt;<span class="xml"></span><br><span class="line">  </span>&lt;%=<span class="ruby"> link_to(<span class="string">"Edit"</span>, edit_post_path(post))</span>%&gt;<span class="xml"></span><br><span class="line"></span>&lt;%<span class="ruby"> <span class="keyword">end</span> </span>%&gt;<span class="xml"></span></span><br></pre></td></tr></table></figure>
<h3 id="No-2_Pre-decorate_with_Helper">No.2 Pre-decorate with Helper</h3><p>经常用的地方先用 helper 整理</p>
<p>BAD:</p>
<figure class="highlight erb"><table><tr><td class="code"><pre><span class="line"><span class="xml"></span>&lt;%=<span class="ruby"> <span class="variable">@topic</span>.content </span>%&gt;<span class="xml"></span></span><br></pre></td></tr></table></figure>
<figure class="highlight erb"><table><tr><td class="code"><pre><span class="line"><span class="xml"></span>&lt;%=<span class="ruby"> auto_link(truncate(simple_format(topic.content)), <span class="symbol">:length</span> =&gt; <span class="number">100</span>) </span>%&gt;<span class="xml"></span></span><br></pre></td></tr></table></figure>
<p>GOOD:</p>
<figure class="highlight erb"><table><tr><td class="code"><pre><span class="line"><span class="xml"></span>&lt;%=<span class="ruby"> render_post_content(<span class="variable">@topic</span>.content) </span>%&gt;<span class="xml"></span></span><br></pre></td></tr></table></figure>
<p>Common Case</p>
<ul>
<li>render_post_author</li>
<li>render_post_published_date</li>
<li>render_post_title</li>
<li>render_post_content</li>
</ul>
<h3 id="No-3_Use_Ruby_in_Helper_ALL_THE_TIME">No.3 Use Ruby in Helper ALL THE TIME</h3><p>在 Helper 中只使用 Ruby 代码，而不要混杂 HTML。因为如果在 Helper 中最后调用 <strong>raw</strong> 或者 <strong>html_safe</strong> 会让代码有被 javascript 攻击的危险</p>
<p>BAD:</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">render_post_taglist</span><span class="params">(post, opts = &#123;&#125;)</span></span></span><br><span class="line">  <span class="comment"># ....</span></span><br><span class="line">   raw tags.collect &#123; |tag|  <span class="string">"&lt;a href=\"<span class="subst">#&#123;posts_path(<span class="symbol">:tag</span> =&gt; tag)&#125;</span>\" class=\"tag\"&gt;<span class="subst">#&#123;tag&#125;</span>&lt;/a&gt;"</span> &#125;.join(<span class="string">", "</span>)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>GOOD:</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">render_post_taglist</span><span class="params">(post, opts = &#123;&#125;)</span></span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">  raw tags.collect &#123; |tag| link_to(tag,posts_path(<span class="symbol">:tag</span> =&gt; tag)) &#125;.join(<span class="string">", "</span>)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h3 id="No-4_mix_Helper_&amp;_Partial">No.4 mix Helper &amp; Partial</h3><p>在 Helper 中可以混合使用 Partial</p>
<p>BAD:</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">render_post_title</span><span class="params">(post)</span></span></span><br><span class="line">  str = <span class="string">""</span></span><br><span class="line">  str += <span class="string">"&lt;li&gt;"</span></span><br><span class="line">  str += link_to(post.title, post_path(post))</span><br><span class="line">  str += <span class="string">"&lt;/li&gt;"</span></span><br><span class="line">  <span class="keyword">return</span> raw(str)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>GOOD:</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">render_post_title</span><span class="params">(post)</span></span></span><br><span class="line">  render <span class="symbol">:partial</span> =&gt; <span class="string">"posts/title_for_helper"</span>, <span class="symbol">:locals</span> =&gt;</span><br><span class="line">&#123; <span class="symbol">:title</span> =&gt; post.title &#125;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h3 id="No-5_Tell,_Don’t_ask">No.5 Tell, Don’t ask</h3><p>先 Query 再传入 Helper。这样可以避免效能低下的问题。</p>
<p>BAD:</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">render_post_taglist</span><span class="params">(post, opts = &#123;&#125;)</span></span></span><br><span class="line">  tags = post.tags</span><br><span class="line">  tags.collect &#123; |tag| link_to(tag, posts_path(<span class="symbol">tag:</span> tag)) &#125;.join(<span class="string">", "</span>)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<figure class="highlight erb"><table><tr><td class="code"><pre><span class="line"><span class="xml"></span>&lt;%<span class="ruby"> <span class="variable">@posts</span>.each <span class="keyword">do</span> |post| </span>%&gt;<span class="xml"></span><br><span class="line">  </span>&lt;%=<span class="ruby"> render_post_taglist(post) </span>%&gt;<span class="xml"></span><br><span class="line"></span>&lt;%<span class="ruby"> <span class="keyword">end</span> </span>%&gt;<span class="xml"></span></span><br></pre></td></tr></table></figure>
<p>GOOD:</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">render_post_taglist</span><span class="params">(tags, opts = &#123;&#125;)</span></span></span><br><span class="line">  tags.collect &#123; |tag| link_to(tag, posts_path(<span class="symbol">tag:</span> tag)) &#125;.join(<span class="string">", "</span>)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<figure class="highlight erb"><table><tr><td class="code"><pre><span class="line"><span class="xml"></span>&lt;%<span class="ruby"> <span class="variable">@posts</span>.each <span class="keyword">do</span> |post| </span>%&gt;<span class="xml"></span><br><span class="line">    </span>&lt;%=<span class="ruby"> render_post_taglist(post.tags) </span>%&gt;<span class="xml"></span><br><span class="line"></span>&lt;%<span class="ruby"> <span class="keyword">end</span> </span>%&gt;<span class="xml"></span><br><span class="line"></span><br><span class="line">def index</span><br><span class="line">  @posts = Post.recent.includes(:tags)</span><br><span class="line">end</span></span><br></pre></td></tr></table></figure>
<h3 id="No-6_Wrap_into_a_method">No.6 Wrap into a method</h3><p>属性尽量包装成 method 而不是放在 helper 中</p>
<p>BAD:</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">render_comment_author</span><span class="params">(comment)</span></span></span><br><span class="line">  <span class="keyword">if</span> comment.user.present?</span><br><span class="line">    comment.user.name</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    comment.custom_name</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>GOOD:</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">render_comment_author</span><span class="params">(comment)</span></span></span><br><span class="line">  comment.author_name</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Comment</span> <span class="inheritance">&lt; <span class="parent">ActiveRecord::Base</span></span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">author_name</span></span></span><br><span class="line">    <span class="keyword">if</span> user.present?</span><br><span class="line">      user.name</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      custom_name</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h3 id="No-7_Move_code_to_Partial">No.7 Move code to Partial</h3><p>view code 超过两页请注意</p>
<ul>
<li>highly duplicated 内容高度重复</li>
<li>independent blocks 可以独立作为功能区块</li>
</ul>
<p>Common Case</p>
<ul>
<li>nav/user_info</li>
<li>nav/admin_menu</li>
<li>vendor_js/google_analytics</li>
<li>vendor_js/disqus_js</li>
<li>global/footer</li>
</ul>
<h3 id="No-8_Use_presenter_to_clean_the_view">No.8 Use presenter to clean the view</h3><p>使⽤ Presenter 解決 login in view 问题</p>
<p>BAD:</p>
<figure class="highlight erb"><table><tr><td class="code"><pre><span class="line"><span class="xml"></span>&lt;%=<span class="ruby"> <span class="keyword">if</span> user_rofile.has_experience? &amp;&amp; user_rofile.experience_public? </span>%&gt;<span class="xml"></span><br><span class="line">  <span class="tag">&lt;<span class="title">p</span>&gt;</span><span class="tag">&lt;<span class="title">strong</span>&gt;</span>Experience:<span class="tag">&lt;/<span class="title">strong</span>&gt;</span> </span>&lt;%=<span class="ruby"> user_profile.experience </span>%&gt;<span class="xml"><span class="tag">&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"></span>&lt;%<span class="ruby"> <span class="keyword">end</span> </span>%&gt;<span class="xml"></span></span><br></pre></td></tr></table></figure>
<p>GOOD:</p>
<figure class="highlight erb"><table><tr><td class="code"><pre><span class="line"><span class="xml"></span>&lt;%<span class="ruby"> user_profile.with_experience <span class="keyword">do</span> </span>%&gt;<span class="xml"></span><br><span class="line">  <span class="tag">&lt;<span class="title">p</span>&gt;</span><span class="tag">&lt;<span class="title">strong</span>&gt;</span>Experience:<span class="tag">&lt;/<span class="title">strong</span>&gt;</span> </span>&lt;%=<span class="ruby"> user_profile.experience </span>%&gt;<span class="xml"><span class="tag">&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"></span>&lt;%<span class="ruby"> <span class="keyword">end</span> </span>%&gt;<span class="xml"></span><br><span class="line"></span>&lt;%<span class="ruby"> user_profile.with_hobbies <span class="keyword">do</span> </span>%&gt;<span class="xml"></span><br><span class="line">  <span class="tag">&lt;<span class="title">p</span>&gt;</span><span class="tag">&lt;<span class="title">strong</span>&gt;</span>Hobbies:<span class="tag">&lt;<span class="title">strong</span>&gt;</span> </span>&lt;%=<span class="ruby"> user_profile.hobbies </span>%&gt;<span class="xml"><span class="tag">&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"></span>&lt;%<span class="ruby"> <span class="keyword">end</span> </span>%&gt;<span class="xml"></span></span><br></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProfilePresenter</span> <span class="inheritance">&lt; </span>::<span class="title">Presenter</span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">with_experience</span><span class="params">(&amp;block)</span></span></span><br><span class="line">    <span class="keyword">if</span> profile.has_experience? &amp;&amp; profile.experience_public?</span><br><span class="line">      block.call(view)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p><strong>关于 presenter 的延伸阅读</strong></p>
<ul>
<li><a href="http://mikepackdev.com/blog_posts/31-exhibit-vs-presenter" target="_blank" rel="external">Exhibit vs Presenter</a></li>
<li><a href="http://stackoverflow.com/questions/15212637/using-presenters-in-rails" target="_blank" rel="external">Using Presenters in rails</a></li>
<li><a href="http://railscasts.com/episodes/287-presenters-from-scratch" target="_blank" rel="external">Presenters from Scratch</a></li>
<li><a href="http://blog.jayfields.com/2007/03/rails-presenter-pattern.html" target="_blank" rel="external">Rails: Presenter Pattern</a></li>
<li><a href="http://new-bamboo.co.uk/blog/2013/04/17/rails-presenters-skinny-everything" target="_blank" rel="external">Rails Presenters – Skinny Everything</a></li>
</ul>
<h3 id="No-9_Cache_Digest">No.9 Cache Digest</h3><p>过去的页面缓存，我们需要自己管理版本，很难维护。新的 digest 缓存策略会自动失效。</p>
<p>BAD:</p>
<figure class="highlight erb"><table><tr><td class="code"><pre><span class="line"><span class="xml"></span>&lt;%<span class="ruby"> cache [v15,<span class="variable">@project</span>] <span class="keyword">do</span> </span>%&gt;<span class="xml"></span><br><span class="line">  aaa</span><br><span class="line">  </span>&lt;%<span class="ruby"> cache [v1<span class="number">0</span>,<span class="variable">@todo</span>] <span class="keyword">do</span> </span>%&gt;<span class="xml"></span><br><span class="line">    bbb</span><br><span class="line">    </span>&lt;%<span class="ruby"> cache [v45,<span class="variable">@todolist</span>] <span class="keyword">do</span> </span>%&gt;<span class="xml"></span><br><span class="line">      zzz</span><br><span class="line">    </span>&lt;%<span class="ruby"> <span class="keyword">end</span> </span>%&gt;<span class="xml"></span><br><span class="line">  </span>&lt;%<span class="ruby"> <span class="keyword">end</span> </span>%&gt;<span class="xml"></span><br><span class="line"></span>&lt;%<span class="ruby"> <span class="keyword">end</span> % </span>%&gt;<span class="xml"></span></span><br></pre></td></tr></table></figure>
<p>GOOD:</p>
<figure class="highlight erb"><table><tr><td class="code"><pre><span class="line"><span class="xml"></span>&lt;%<span class="ruby"> cache <span class="variable">@project</span> <span class="keyword">do</span> </span>%&gt;<span class="xml"></span><br><span class="line">  aaa</span><br><span class="line">  </span>&lt;%<span class="ruby"> cache <span class="variable">@todo</span> <span class="keyword">do</span> </span>%&gt;<span class="xml"></span><br><span class="line">    bbb</span><br><span class="line">    </span>&lt;%<span class="ruby"> cache <span class="variable">@todolist</span> <span class="keyword">do</span> </span>%&gt;<span class="xml"></span><br><span class="line">      ccc</span><br><span class="line">    </span>&lt;%<span class="ruby"> <span class="keyword">end</span> </span>%&gt;<span class="xml"></span><br><span class="line">  </span>&lt;%<span class="ruby"> <span class="keyword">end</span> </span>%&gt;<span class="xml"></span><br><span class="line"></span>&lt;%<span class="ruby"> <span class="keyword">end</span> </span>%&gt;<span class="xml"></span></span><br></pre></td></tr></table></figure>
<p><strong>关于 Cache Digest 的延伸阅读</strong></p>
<ul>
<li><a href="https://github.com/rails/cache_digests" target="_blank" rel="external">cache_digests on github</a></li>
<li><a href="http://railscasts.com/episodes/387-cache-digests" target="_blank" rel="external">Cache Digests</a></li>
</ul>
<h3 id="No-10_Cells">No.10 Cells</h3><p>当同一个页面含有多个 Tab ，它会造成如下问题：</p>
<ul>
<li>Controller code 特别长，因为需要取出很多不同数据存入的变量</li>
<li>在 controller &amp; view 有性能问题不好找到</li>
<li>很难设置 action 级别的缓存</li>
</ul>
<p>BAD:</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UsersController</span> <span class="inheritance">&lt; <span class="parent">ApplicationController</span></span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">show</span></span></span><br><span class="line">    <span class="variable">@user</span> = <span class="constant">User</span>.find(params[<span class="symbol">:id</span>])</span><br><span class="line">    <span class="variable">@recent_posts</span> = <span class="variable">@user</span>.recent_posts.limit(<span class="number">5</span>)</span><br><span class="line">    <span class="variable">@favorite_posts</span> = <span class="variable">@user</span>.favorite_posts.limit(<span class="number">5</span>)</span><br><span class="line">    <span class="variable">@recent_comments</span> = <span class="variable">@user</span>.comments.limit(<span class="number">5</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<figure class="highlight erb"><table><tr><td class="code"><pre><span class="line"><span class="xml"></span>&lt;%=<span class="ruby"> render <span class="symbol">:partial</span> =&gt; <span class="string">"users/recent_post"</span>, <span class="symbol">:collection</span> =&gt; <span class="variable">@recent_posts</span> </span>%&gt;<span class="xml"></span><br><span class="line"></span>&lt;%=<span class="ruby"> render <span class="symbol">:partial</span> =&gt; <span class="string">"users/favorite_post"</span>, <span class="symbol">:collection</span> =&gt; <span class="variable">@favorite_posts</span> </span>%&gt;<span class="xml"></span><br><span class="line"></span>&lt;%=<span class="ruby"> render <span class="symbol">:partial</span> =&gt; <span class="string">"users/recent_comment"</span>, <span class="symbol">:collection</span> =&gt; <span class="variable">@recent_comments</span> </span>%&gt;<span class="xml"></span></span><br></pre></td></tr></table></figure>
<p>GOOD:</p>
<figure class="highlight erb"><table><tr><td class="code"><pre><span class="line"><span class="xml"></span>&lt;%=<span class="ruby"> render_cell <span class="symbol">:user</span>, <span class="symbol">:rencent_posts</span>, <span class="symbol">:user</span> =&gt; <span class="variable">@user</span> </span>%&gt;<span class="xml"></span><br><span class="line"></span>&lt;%=<span class="ruby"> render_cell <span class="symbol">:user</span>, <span class="symbol">:favorite_posts</span>, <span class="symbol">:user</span> =&gt; <span class="variable">@user</span> </span>%&gt;<span class="xml"></span><br><span class="line"></span>&lt;%=<span class="ruby"> render_cell <span class="symbol">:user</span>, <span class="symbol">:recent_comments</span>, <span class="symbol">:user</span> =&gt; <span class="variable">@user</span> </span>%&gt;<span class="xml"></span></span><br></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UsersController</span> <span class="inheritance">&lt; <span class="parent">ApplicationController</span></span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">show</span></span></span><br><span class="line">    <span class="variable">@user</span> = <span class="constant">User</span>.find(params[<span class="symbol">:id</span>])</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserCell</span> <span class="inheritance">&lt; <span class="parent">Cell::Rails</span></span></span></span><br><span class="line">  cache <span class="symbol">:recent_posts</span>, <span class="symbol">:expires_in</span> =&gt; <span class="number">1</span>.hours</span><br><span class="line">  cache <span class="symbol">:favorite_posts</span>, <span class="symbol">:expires_in</span> =&gt; <span class="number">3</span>.hours</span><br><span class="line">  cache <span class="symbol">:recent_comments</span>, <span class="symbol">:expires_in</span> =&gt; <span class="number">5</span>.hours</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">recent_posts</span><span class="params">(args)</span></span></span><br><span class="line">   <span class="comment">#...</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">favorite_posts</span><span class="params">(args)</span></span></span><br><span class="line">    <span class="comment">#...</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">recent_comments</span><span class="params">(args)</span></span></span><br><span class="line">    <span class="comment">#...</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p><strong>关于 Cells 的延伸阅读</strong></p>
<ul>
<li><a href="https://github.com/apotonick/cells" target="_blank" rel="external">cells on github</a></li>
</ul>
<h3 id="No-11_content_for_/_yield">No.11 content_for / yield</h3><p>根据 Yahoo 大神的建议，应该把 javascript 和 css 代码放在页面的最下面。以便加快加载，但是会造成一些问题。比如你自定义的 js 代码比 jquery 库更早加载，以至于无法运行你的代码。</p>
<p>例子1:</p>
<figure class="highlight erb"><table><tr><td class="code"><pre><span class="line"><span class="xml"><span class="comment">&lt;!-- application.html.erb --&gt;</span></span><br><span class="line"></span>&lt;%=<span class="ruby"> stylesheet_link_tag <span class="string">"application"</span> </span>%&gt;<span class="xml"></span><br><span class="line"></span>&lt;%=<span class="ruby"> <span class="keyword">yield</span> </span>%&gt;<span class="xml"></span><br><span class="line"></span>&lt;%=<span class="ruby"> javascript_include_tag <span class="string">"application"</span> </span>%&gt;<span class="xml"></span><br><span class="line"></span>&lt;%=<span class="ruby"> <span class="keyword">yield</span> <span class="symbol">:page_specific_javascript</span> </span>%&gt;<span class="xml"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- main.html.erb --&gt;</span></span><br><span class="line"></span>&lt;%=<span class="ruby"> content_for <span class="symbol">:page_specific_javascript</span> <span class="keyword">do</span> </span>%&gt;<span class="xml"></span><br><span class="line">  <span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>= "<span class="attribute">text</span>/<span class="attribute">javascript</span>"&gt;</span><span class="actionscript"></span><br><span class="line">    <span class="comment">// your script here</span></span><br><span class="line">  </span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"></span>&lt;%<span class="ruby"> <span class="keyword">end</span> </span>%&gt;<span class="xml"></span></span><br></pre></td></tr></table></figure>
<p>例子2:</p>
<figure class="highlight erb"><table><tr><td class="code"><pre><span class="line"><span class="xml"><span class="comment">&lt;!-- application.html.erb --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"main"</span>&gt;</span></span><br><span class="line">  </span>&lt;%=<span class="ruby"> <span class="keyword">yield</span> </span>%&gt;<span class="xml"></span><br><span class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"sidebar"</span>&gt;</span></span><br><span class="line">  </span>&lt;%=<span class="ruby"> <span class="keyword">yield</span> <span class="symbol">:sidebar</span> </span>%&gt;<span class="xml"></span><br><span class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- main.html.erb --&gt;</span></span><br><span class="line"></span>&lt;%=<span class="ruby"> content_for <span class="symbol">:sidebar</span> <span class="keyword">do</span> </span>%&gt;<span class="xml"></span><br><span class="line">  </span>&lt;%=<span class="ruby"> render <span class="string">"ad/foo"</span></span>%&gt;<span class="xml"></span><br><span class="line"></span>&lt;%<span class="ruby"> <span class="keyword">end</span> </span>%&gt;<span class="xml"></span></span><br></pre></td></tr></table></figure>
<h3 id="No-12_Decoration_in_Controller">No.12 Decoration in Controller</h3><p>有个别情况，可以把一些代码放在 controller 中</p>
<p>BAD:</p>
<figure class="highlight erb"><table><tr><td class="code"><pre><span class="line"><span class="xml"></span>&lt;%=<span class="ruby"> content_for <span class="symbol">:meta</span> <span class="keyword">do</span> </span>%&gt;<span class="xml"></span><br><span class="line">  <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">content</span>=<span class="value">"xdite's blog"</span> <span class="attribute">name</span>=<span class="value">"description"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">content</span>=<span class="value">"Blog.XDite.net"</span> <span class="attribute">property</span>=<span class="value">"og:title"</span>&gt;</span></span><br><span class="line"></span>&lt;%<span class="ruby"> <span class="keyword">end</span> </span>%&gt;<span class="xml"></span></span><br></pre></td></tr></table></figure>
<p>GOOD:</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span></span></span><br><span class="line">  <span class="variable">@blog</span> = current_blog</span><br><span class="line">  drop_blog_title <span class="variable">@blog</span>.name</span><br><span class="line">  drop_blog_descption <span class="variable">@blog</span>.description</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<figure class="highlight erb"><table><tr><td class="code"><pre><span class="line"><span class="xml"></span>&lt;%=<span class="ruby"> stylesheet_tag <span class="string">"application"</span> </span>%&gt;<span class="xml"></span><br><span class="line"></span>&lt;%=<span class="ruby"> render_page_title </span>%&gt;<span class="xml"></span><br><span class="line"></span>&lt;%=<span class="ruby"> render_page_descrption </span>%&gt;<span class="xml"></span></span><br></pre></td></tr></table></figure>
<h3 id="No-13_Decoration_using_I18n">No.13 Decoration using I18n</h3><p>善用 I18n 也可以帮你减少一部分 View 代码</p>
<p>BAD:</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">render_user_geneder</span><span class="params">(user)</span></span></span><br><span class="line">  <span class="keyword">if</span> user.gender == <span class="string">"male"</span></span><br><span class="line">    <span class="string">"男 (Male)"</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="string">"⼥女 (Female)"</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>GOOD:</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">render_user_gender</span><span class="params">(user)</span></span></span><br><span class="line">  <span class="constant">I18n</span>.t(<span class="string">"users.gender_desc.<span class="subst">#&#123;user.geneder&#125;</span>"</span>)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h3 id="No-14_Decoration_using_Decorator">No.14 Decoration using Decorator</h3><p>不要把所有代码都往 Model 中扔，下面的代码演示了一种情况，你需要格式化一种显示发布时间的方法</p>
<p>BAD:</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="comment"># first helper</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">render_article_publish_status</span><span class="params">(article)</span></span></span><br><span class="line">  <span class="keyword">if</span> article.published?</span><br><span class="line">    <span class="string">"Published at <span class="subst">#&#123;article.published_at.strftime(<span class="string">'%A, %B %e'</span>)&#125;</span>"</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="string">"Unpublished"</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># then model method</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Article</span> <span class="inheritance">&lt; <span class="parent">ActiveRecord::Base</span></span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">human_publish_status</span></span></span><br><span class="line">    <span class="keyword">if</span> published?</span><br><span class="line">      <span class="string">"Published at <span class="subst">#&#123;article.published_at.strftime(<span class="string">'%A, %B %e'</span>)&#125;</span>"</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="string">"Unpublished"</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># then ...</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Article</span> <span class="inheritance">&lt; <span class="parent">ActiveRecord::Base</span></span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">human_publish_status</span></span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">human_publish_time</span></span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">human_author_name</span></span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  <span class="comment">#........</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># at last</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Article</span> <span class="inheritance">&lt; <span class="parent">ActiveRecord::Base</span></span></span></span><br><span class="line">  <span class="keyword">include</span> <span class="constant">HumanArticleAttributes</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>下面的代码演示使用 <a href="https://github.com/drapergem/draper" target="_blank" rel="external">https://github.com/drapergem/draper</a> 之后</p>
<p>GOOD:</p>
<figure class="highlight erb"><table><tr><td class="code"><pre><span class="line"><span class="xml"></span>&lt;%=<span class="ruby"> <span class="variable">@article</span>.publication_status </span>%&gt;<span class="xml"></span></span><br></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ArticleDecorator</span> <span class="inheritance">&lt; <span class="parent">Draper::Decorator</span></span></span></span><br><span class="line">  delegate_all</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">publication_status</span></span></span><br><span class="line">    <span class="keyword">if</span> published?</span><br><span class="line">      <span class="string">"Published at <span class="subst">#&#123;published_at&#125;</span>"</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="string">"Unpublished"</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">published_at</span></span></span><br><span class="line">    object.published_at.strftime(<span class="string">"%A, %B %e"</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span></span></span><br><span class="line">  <span class="variable">@article</span> = <span class="constant">Article</span>.find(params[<span class="symbol">:id</span>]).decorate</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p><strong>关于 draper 的延伸阅读</strong></p>
<ul>
<li><a href="https://github.com/drapergem/draper" target="_blank" rel="external">draper on github</a></li>
<li><a href="https://www.ruby-toolbox.com/categories/rails_presenters" target="_blank" rel="external">rails_presenters gems</a></li>
</ul>
<h3 id="No-15_Decoration_using_View_Object">No.15 Decoration using View Object</h3><p>有时候，我们希望在用户中，不列出我自己</p>
<p>BAD:</p>
<figure class="highlight erb"><table><tr><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="title">dl</span> <span class="attribute">class</span>=<span class="value">"event-detail"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">dt</span>&gt;</span>Event Host<span class="tag">&lt;/<span class="title">dt</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">dd</span>&gt;</span></span><br><span class="line">    </span>&lt;%<span class="ruby"> <span class="keyword">if</span> <span class="variable">@event</span>.host == current_user </span>%&gt;<span class="xml"></span><br><span class="line">      You</span><br><span class="line">    </span>&lt;%<span class="ruby"> <span class="keyword">else</span> </span>%&gt;<span class="xml"></span><br><span class="line">      </span>&lt;%=<span class="ruby"> <span class="variable">@event</span>.host.name </span>%&gt;<span class="xml"></span><br><span class="line">    </span>&lt;%<span class="ruby"> <span class="keyword">end</span> </span>%&gt;<span class="xml"></span><br><span class="line">  <span class="tag">&lt;/<span class="title">dd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">dt</span>&gt;</span>Participants<span class="tag">&lt;/<span class="title">dt</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">dd</span>&gt;</span></span><br><span class="line">    </span>&lt;%=<span class="ruby"> <span class="variable">@event</span>.participants.reject &#123; |p| p == current_user &#125;.map(&amp;<span class="symbol">:name</span>).join(<span class="string">", "</span>) </span>%&gt;<span class="xml"></span><br><span class="line">  <span class="tag">&lt;/<span class="title">dd</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">dl</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>GOOD:</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EventDetailView</span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">initialize</span><span class="params">(template, event, current_user)</span></span></span><br><span class="line">    <span class="variable">@template</span> = template</span><br><span class="line">    <span class="variable">@event</span> = event</span><br><span class="line">    <span class="variable">@current_user</span> = current_user</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">host</span></span></span><br><span class="line">    <span class="keyword">if</span> <span class="variable">@event</span>.host == <span class="variable">@current_user</span></span><br><span class="line">      <span class="string">"You"</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="variable">@event</span>.host.name</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">participant_names</span></span></span><br><span class="line">    participants.map(&amp;<span class="symbol">:name</span>).join(<span class="string">", "</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  private</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">participants</span></span></span><br><span class="line">    <span class="variable">@event</span>.participants.reject &#123; |p| p == <span class="variable">@current_user</span> &#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<figure class="highlight erb"><table><tr><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="title">dl</span> <span class="attribute">class</span>=<span class="value">"event-detail"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">dt</span>&gt;</span>Host<span class="tag">&lt;/<span class="title">dt</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">dd</span>&gt;</span></span>&lt;%=<span class="ruby"> event_detail.host </span>%&gt;<span class="xml"><span class="tag">&lt;/<span class="title">dd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">dt</span>&gt;</span>Participants<span class="tag">&lt;/<span class="title">dt</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">dd</span>&gt;</span></span>&lt;%=<span class="ruby"> event_detail.participant_names </span>%&gt;<span class="xml"><span class="tag">&lt;/<span class="title">dd</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">dl</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h3 id="No-16_Form_builder">No.16 Form builder</h3><ul>
<li>simple_form</li>
<li>bootstrap_form</li>
</ul>
<h3 id="No-17_Form_Object">No.17 Form Object</h3><p>在 FORM 中包装逻辑，而不是 model 或 controller。比如我们经常遇到的一个情况，只有同意某某条款才能继续注册表单。</p>
<p><strong>Reform</strong> Decouples your models from form validation, presentation and workflows.</p>
<p><a href="https://github.com/apotonick/reform" target="_blank" rel="external">https://github.com/apotonick/reform</a></p>
<h3 id="No-18_Policy_Object_/_Rule_Engine">No.18 Policy Object / Rule Engine</h3><p>权限控制</p>
<p>BAD:</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">render_post_edit_option</span><span class="params">(post)</span></span></span><br><span class="line">  <span class="keyword">if</span> post.user == current_user || current_user.admin?</span><br><span class="line">    render <span class="symbol">:partial</span> =&gt; <span class="string">"post/edit_bar"</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>针对于这种情况建议使用权限控制系统，另外近来似乎大家都从 Cancan 转移到 Pundit 去了</p>
<p><strong>Pundit</strong> Minimal authorization through OO design and pure Ruby classes</p>
<p><a href="https://github.com/elabs/pundit" target="_blank" rel="external">https://github.com/elabs/pundit</a></p>
<p><strong>Cancan</strong> Authorization Gem for Ruby on Rails</p>
<p><a href="https://github.com/ryanb/cancan" target="_blank" rel="external">https://github.com/ryanb/cancan</a></p>
<h2 id="总结">总结</h2><ul>
<li>总是假设这块正在实现的功能代码需要 decorated（修饰）</li>
<li>把逻辑移到 methods/classes</li>
<li>避免在 View/Helper 中做数据库查询</li>
<li>当代码很难懂的时候，把它抽取到一个新的控制中心比如：form object, Policy Object 之类的</li>
</ul>
<h2 id="延伸阅读">延伸阅读</h2><ul>
<li><a href="http://blog.xdite.net" target="_blank" rel="external">http://blog.xdite.net</a></li>
<li><a href="https://github.com/bloudermilk/maintainable_templates" target="_blank" rel="external">https://github.com/bloudermilk/maintainable_templates</a> <a href="http://pivotallabs.com/form-backing-objects-for-fun-and-profit/" target="_blank" rel="external">http://pivotallabs.com/form-backing-objects-for-fun-and-profit/</a></li>
<li><a href="http://saturnflyer.com/blog/jim/2013/10/21/how-to-make-your-code-imply-responsibilities/" target="_blank" rel="external">http://saturnflyer.com/blog/jim/2013/10/21/how-to-make-your-code-imply-responsibilities/</a></li>
<li><a href="http://objectsonrails.com/" target="_blank" rel="external">http://objectsonrails.com/</a></li>
</ul>
<h2 id="出处">出处</h2><p>以上内容由 <strong>Victor</strong> 整理，本人只是记录在blog中。</p>

    
  </div>
  <footer class="end-sep">
    
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <a href="/live-2014-01-12-2013-summary/">
  <time datetime="2014-01-12T07:48:29.000Z">
    2014-01-12
  </time>
</a>
    
    
  
    <h1 class="title"><a href="/live-2014-01-12-2013-summary/">2013年终总结</a></h1>
  

  </header>
  
  <div class="entry">
    
      <p>匆匆忙忙的一年又过去了, 万分感慨，时间过得好快。今天好好总结一下。</p>
<h3 id="跨年晚上写在Evernote的总结:">跨年晚上写在Evernote的总结:</h3><p>每每感觉时间过得好快，尤其是今年，可能岁数越大越觉得时间过得快。<br>今年喜忧参半。</p>
<h4 id="最难过的事：">最难过的事：</h4><p>姥爷在12月20日晚上突然去世，我们都没在身边，是满满的愧疚。<br>中秋节，专门回老家，去看了看他们，过程不算愉快吧，没想到竟是最后一面！</p>
<h4 id="最开心的事：">最开心的事：</h4><p>找到了她，也许真的是上辈子的缘分，自然而然的在一起了，<br>我的忧伤与欢乐有她分享了。</p>
<h4 id="最尴尬的事：">最尴尬的事：</h4><p>2013年4月底从公司辞职，其实早有准备，<br>与公司的文化、开发团队的理念合不来，捱过这半年很痛苦。<br>不过缓解了我的经济压力，买了mac mini 当开发机。</p>
<p>接下来的3个月找工作，先去了趟青岛，高高兴兴的玩了一阵，然后回到北京找工作。<br>在找工作的这段期间，暴露了很多问题： 算法是永远的痛，表达的思路不是很清楚 ……</p>
<hr>
<h3 id="今日总结:">今日总结:</h3><p>针对算法的短板，我找到了 <a href="http://projecteuler.net/" target="_blank" rel="external">projecteuler</a>，<br>做了一些练习题,放到了<a href="https://github.com/shooterman/projecteuler.net" target="_blank" rel="external">我的github的project中</a>。<br>对我来说挑战不小，而且之后因为工作的原因，也做不下去了。<br><strong>抽出时间继续做 projecteuler</strong>，<br>对于难的问题，一周完成一个还不行么，这么低的要求，还完成不了么?</p>
<p><strong>写blog要勤快</strong>， 写blog也是一种锻炼思维的方式。</p>
<p>发现一本涉及ruby底层的书 <a href="http://patshaughnessy.net/ruby-under-a-microscope" target="_blank" rel="external">Ruby Under a Microscope</a>，很赞，纯英文，还可以提高英语水平。<br><strong>读完 Ruby Under a Microscope</strong>。</p>
<p><strong>积极锻炼身体</strong>，现在体重涨了，再不加强锻炼，以后咋面对媳妇！？ 基本上没经验，<br>一定要现在起步，从长计议。</p>
<p><strong>完成个人的一个小项目或者接一个小的外包</strong> ， 2013最缺什么，money!</p>
<p>对于表达交流上的问题，有意识的去控制语速，列出提纲，多参加一些交流活动。<br>前段时间参加了rails girls，当coach，是一种不错的锻炼。<br>有时间的话，一定要<strong>多参加活动</strong>，积累好人缘。</p>
<p><strong>希望我和她幸福快乐</strong></p>
<p>PS:  GF生病发烧了，我不在身边，快点好起来吧！阿门</p>

    
  </div>
  <footer class="end-sep">
    
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <a href="/tech-2013-11-22-5-useful-tips-for-a-better-commit-message/">
  <time datetime="2013-11-22T08:39:16.000Z">
    2013-11-22
  </time>
</a>
    
    
  
    <h1 class="title"><a href="/tech-2013-11-22-5-useful-tips-for-a-better-commit-message/">写出好的 commit message</a></h1>
  

  </header>
  
  <div class="entry">
    
      <h2 id="为什幺要关注提交信息">为什幺要关注提交信息</h2><ul>
<li>加快 Reviewing Code 的过程</li>
<li>帮助我们写好 release note</li>
<li>5年后帮你快速想起来某个分支，tag 或者 commit 增加了什么功能，改变了哪些代码</li>
<li><p>让其他的开发者在运行 <figure class="highlight"><figcaption><span>blame``` 的时候想跪谢</span></figcaption><table><tr><td class="code"><pre><span class="line">* &#24635;&#20043;&#19968;&#20010;&#22909;&#30340;&#25552;&#20132;&#20449;&#24687;&#65292;&#20250;&#24110;&#21161;&#20320;&#25552;&#39640;&#39033;&#30446;&#30340;&#25972;&#20307;&#36136;&#37327;&#10;&#10;##&#22522;&#26412;&#35201;&#27714;&#10;&#10;* &#31532;&#19968;&#34892;&#24212;&#35813;&#23569;&#20110;50&#20010;&#23383;&#12290; **&#38543;&#21518;&#26159;&#19968;&#20010;&#31354;&#34892;** &#31532;&#19968;&#34892;&#39064;&#30446;&#20063;&#21487;&#20197;&#20889;&#25104;&#65306;```Fix issue #8976</span><br></pre></td></tr></table></figure></p>
</li>
<li><p>喜欢用 vim 的哥们把下面这行代码加入 <em>.vimrc</em> 文件中，来检查拼写和自动折行</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">autocmd Filetype gitcommit setlocal spell textwidth=72</span><br></pre></td></tr></table></figure>
<ul>
<li>永远不在 <figure class="highlight"><figcaption><span>commit``` 上增加 ```-m <msg>``` 或 ```--message=<msg>``` 参数，而单独写提交信息</msg></msg></span></figcaption><table><tr><td class="code"><pre><span class="line">&#10;&#19968;&#20010;&#19981;&#22909;&#30340;&#20363;&#23376; ```git commit -m &#34;Fix login bug&#34;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>一个推荐的 commit message 应该是这样：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Redirect user to the requested page after login&#10;&#10;https://trello.com/path/to/relevant/card&#10;&#10;Users were being redirected to the home page after login, which is less&#10;useful than redirecting to the page they had originally requested before&#10;being redirected to the login form.&#10;&#10;* Store requested path in a session variable&#10;* Redirect to the stored location after successfully logging in the user</span><br></pre></td></tr></table></figure>
<ul>
<li>注释最好包含一个连接指向你们项目的 issue/story/card。一个完整的连接比一个 issue numbers 更好</li>
<li>提交信息中包含一个简短的故事，能让别人更容易理解你的项目</li>
</ul>
<h2 id="注释要回答如下信息">注释要回答如下信息</h2><p><strong>为什么这次修改是必要的？</strong></p>
<p>要告诉 Reviewers，你的提交包含什么改变。让他们更容易审核代码和忽略无关的改变。</p>
<p><strong>如何解决的问题？</strong></p>
<p>这可不是说技术细节。看下面的两个例子：</p>
<figure class="highlight"><figcaption><span>a red/black tree to increase search speed```</span></figcaption><table><tr><td class="code"><pre><span class="line">&#10;```Remove &#60;troublesome gem X&#62;, which was causing &#60;specific description of issue introduced by gem&#62;</span><br></pre></td></tr></table></figure>
<p>如果你的修改特别明显，就可以忽略这个。</p>
<p><strong>这些变化可能影响哪些地方？</strong></p>
<p>这是你最需要回答的问题。因为它会帮你你发现在某个 branch 或 commit 中的做了过多的改动。一个提交尽量只做1，2个变化。</p>
<p>你的团队应该有一个自己的行为规则，规定每个 commit 和 branch 最多能含有多少个功能修改。</p>
<h2 id="小提示">小提示</h2><ul>
<li>使用 <em>fix</em>, <em>add</em>, <em>change</em> 而不是 <em>fixed</em>, <em>added</em>, <em>changed</em></li>
<li>永远别忘了第2行是空行</li>
<li>用 <em>Line break</em> 来分割提交信息，让它在某些软件里面更容易读</li>
</ul>
<h2 id="例子">例子</h2><pre><code>Fix bug <span class="keyword">where</span> user can't signup.

[Bug <span class="comment">#2873942]</span>

Users were unable <span class="keyword">to</span> register <span class="keyword">if</span> they hadn't visited <span class="keyword">the</span> plans
<span class="keyword">and</span> pricing page because we expected <span class="keyword">that</span> tracking
information <span class="keyword">to</span> exist <span class="keyword">for</span> <span class="keyword">the</span> logs we create <span class="keyword">after</span> a user
signs up.  I fixed this <span class="keyword">by</span> adding a check <span class="keyword">to</span> <span class="keyword">the</span> logger
<span class="keyword">to</span> ensure <span class="keyword">that</span> <span class="keyword">if</span> <span class="keyword">that</span> information was <span class="keyword">not</span> available
we weren't trying <span class="keyword">to</span> <span class="command">write</span> <span class="keyword">it</span>.
</code></pre><p><br></p>
<pre><code>Redirect user <span class="built_in">to</span> <span class="operator">the</span> requested page <span class="keyword">after</span> login

<span class="keyword">https</span>://trello.com/path/<span class="built_in">to</span>/relevant/card

Users were being redirected <span class="built_in">to</span> <span class="operator">the</span> home page <span class="keyword">after</span> login, which is less
useful than redirecting <span class="built_in">to</span> <span class="operator">the</span> page they had originally requested <span class="keyword">before</span>
being redirected <span class="built_in">to</span> <span class="operator">the</span> login form.

* Store requested path <span class="operator">in</span> <span class="operator">a</span> session <span class="built_in">variable</span>
* Redirect <span class="built_in">to</span> <span class="operator">the</span> stored location <span class="keyword">after</span> successfully logging <span class="operator">in</span> <span class="operator">the</span> user
</code></pre><h2 id="延伸阅读">延伸阅读</h2><ul>
<li><a href="http://web-design-weekly.com/blog/2013/09/01/a-better-git-commit/" target="_blank" rel="external">A Note About Git Commit Messages</a></li>
<li><a href="http://ablogaboutcode.com/2011/03/23/proper-git-commit-messages-and-an-elegant-git-history/" target="_blank" rel="external">Writing good commit messages</a></li>
<li><a href="https://github.com/erlang/otp/wiki/Writing-good-commit-messages" target="_blank" rel="external">Proper Git Commit Messages and an Elegant Git History</a></li>
<li><a href="http://tbaggery.com/2008/04/19/a-note-about-git-commit-messages.html" target="_blank" rel="external">A Better Git Commit</a></li>
<li><a href="http://robots.thoughtbot.com/5-useful-tips-for-a-better-commit-message" target="_blank" rel="external">5 Useful Tips For A Better Commit Message </a></li>
<li><a href="http://whatthecommit.com/" target="_blank" rel="external">好玩的提交信息</a></li>
</ul>
<hr>
<h2 id="出处">出处</h2><p>文章由 <strong>Victor</strong> 翻译，并发表在<a href="http://ruby-china.org/topics/15737" target="_blank" rel="external">ruby-china</a>上。<br>本人只是伸手党</p>

    
  </div>
  <footer class="end-sep">
    
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <a href="/tech-2013-11-08-resque-for-rails/">
  <time datetime="2013-11-08T04:13:40.000Z">
    2013-11-08
  </time>
</a>
    
    
  
    <h1 class="title"><a href="/tech-2013-11-08-resque-for-rails/">rails使用队列resque</a></h1>
  

  </header>
  
  <div class="entry">
    
      <h3 id="准备">准备</h3><p><a href="https://github.com/resque/resque" target="_blank" rel="external">Resque</a> 依赖 <a href="http://redis.io/" target="_blank" rel="external">Redis</a>，<br>请先安装reids数据库。</p>
<hr>
<h3 id="安装Resque">安装Resque</h3><pre><code><span class="title">gem</span> <span class="string">"resque"</span>, <span class="string">"~&gt; 1.25.1"</span>
</code></pre><p>运行 resque-web 会打开 <a href="http://0.0.0.0:5678/overview" target="_blank" rel="external">http://0.0.0.0:5678/overview</a></p>
<h5 id="创建Rake">创建Rake</h5><p>lib/tasks/resque.rake</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">'resque/tasks'</span></span><br><span class="line"></span><br><span class="line">task <span class="string">"resque:setup"</span> =&gt; <span class="symbol">:environment</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># task "resque:setup" =&gt; :environment do</span></span><br><span class="line"><span class="comment">#   ENV['QUEUE'] = "*"</span></span><br><span class="line"><span class="comment"># end</span></span><br><span class="line"><span class="comment"># 执行 rake resque:work 会启动所有队列</span></span><br></pre></td></tr></table></figure>
<h5 id="创建任务">创建任务</h5><p>app/workers/resque_job.rb</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ResqueJob</span></span></span><br><span class="line">  <span class="variable">@queue</span> = <span class="symbol">:resque_job</span> <span class="comment">#定义队列名称</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">perform</span><span class="params">(u_name)</span> <span class="comment">#必须定义 执行方法体</span></span></span><br><span class="line">    puts <span class="string">"hello <span class="subst">#&#123;u_name&#125;</span>"</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h5 id="启动_queue">启动 queue</h5><p>rake resque:work QUEUE=’*’ #启动所有队列</p>
<p>rake resque:work QUEUE=’resque_job’ #启动队列名称为resque_job的单个队列</p>
<h5 id="调用_queue">调用 queue</h5><figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="constant">Resque</span>.enqueue(<span class="constant">ResqueJob</span>,<span class="string">"everyone"</span>) <span class="comment">#调用队列</span></span><br></pre></td></tr></table></figure>
<h4 id="项目中查看resque任务">项目中查看resque任务</h4><figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">gem <span class="string">"resque"</span>, <span class="string">"~&gt; 1.25.1"</span>, <span class="symbol">:require</span> =&gt; <span class="string">"resque/server"</span></span><br><span class="line">mount <span class="constant">Resque::Server</span>, <span class="symbol">:at</span> =&gt; <span class="string">"/resque"</span> <span class="comment"># routes.rb</span></span><br></pre></td></tr></table></figure>
<p>访问 <a href="http://0.0.0.0:3000/resque/overview" target="_blank" rel="external">http://0.0.0.0:3000/resque/overview</a></p>
<h4 id="限制访问">限制访问</h4><figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="comment"># config/initializers/resque_auth.rb</span></span><br><span class="line"><span class="constant">Resque::Server</span>.use(<span class="constant">Rack::Auth::Basic</span>) <span class="keyword">do</span> |user, password|</span><br><span class="line">  password == <span class="string">"password"</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="Redis_命令行">Redis 命令行</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">redis-server #Redis&#26381;&#21153;&#22120;&#30340;daemon&#21551;&#21160;&#31243;&#24207;&#10;&#10;redis-cli #Redis&#21629;&#20196;&#34892;&#25805;&#20316;&#24037;&#20855;&#12290;&#24403;&#28982;&#65292;&#20320;&#20063;&#21487;&#20197;&#29992;telnet&#26681;&#25454;&#20854;&#32431;&#25991;&#26412;&#21327;&#35758;&#26469;&#25805;&#20316;&#10;&#10;redis-benchmark #Redis&#24615;&#33021;&#27979;&#35797;&#24037;&#20855;&#65292;&#27979;&#35797;Redis&#22312;&#20320;&#30340;&#31995;&#32479;&#21450;&#20320;&#30340;&#37197;&#32622;&#19979;&#30340;&#35835;&#20889;&#24615;&#33021;&#10;&#10;redis-stat #Redis&#29366;&#24577;&#26816;&#27979;&#24037;&#20855;&#65292;&#21487;&#20197;&#26816;&#27979;Redis&#24403;&#21069;&#29366;&#24577;&#21442;&#25968;&#21450;&#24310;&#36831;&#29366;&#20917;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="定时队列">定时队列</h3><pre><code>gem <span class="string">"resque-scheduler"</span>, <span class="string">"~&gt; 2.0.1"</span>  :<span class="keyword">require</span> =&gt; <span class="string">"resque_scheduler"</span>
</code></pre>
    
  </div>
  <footer class="end-sep">
    
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <a href="/tech-2013-11-06-whenever/">
  <time datetime="2013-11-06T09:30:26.000Z">
    2013-11-06
  </time>
</a>
    
    
  
    <h1 class="title"><a href="/tech-2013-11-06-whenever/">在rails中创建定时任务</a></h1>
  

  </header>
  
  <div class="entry">
    
      <p><a href="https://github.com/javan/whenever" target="_blank" rel="external">whenever</a></p>
<h3 id="安装_运行">安装 运行</h3><p>1 gem “whenever”, “~&gt; 0.8.4”</p>
<p>2 在命令行输入 <figure class="highlight"><figcaption><span>.```</span></figcaption><table><tr><td class="code"><pre><span class="line">&#10;&#29983;&#25104;config/schedule.rb&#10;&#10;3 &#32534;&#20889; schedule.rb&#10;&#10;```ruby&#10;env :PATH, ENV[&#39;PATH&#39;]&#10;set :output, &#123;:error =&#62; File.join(Whenever.path, &#34;log&#34;, &#34;cron_err.log&#34;), :standard =&#62;File.join(Whenever.path, &#34;log&#34;, &#34;cron_out.log&#34;)&#125;&#10;set :environment, &#39;development&#39;</span><br></pre></td></tr></table></figure></p>
<p>4 执行</p>
<pre><code>whenever <span class="comment">#根据schedule.rb 转换成cron语法, 不会写入crontab文件</span>

whenever --update-crontab <span class="comment">#写入crontab文件</span>

whenever -s <span class="literal">environment</span>=development -w ~/minsheng/config/<span class="keyword">schedule</span>.rb

whenever --help
</code></pre><h3 id="linux_crontab_命令">linux crontab 命令</h3><pre><code>crontab <span class="operator">-l</span> <span class="comment"># 列出某个用户cron服务的详细内容</span>
crontab <span class="operator">-e</span> <span class="comment"># 修改</span>
crontab -r <span class="comment"># 删除某个用户的cron服务</span>
</code></pre><h3 id="schedule-rb_示例">schedule.rb 示例</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">every 3.hours do&#10;  runner &#34;MyModel.some_process&#34;&#10;  rake &#34;my:rake:task&#34;&#10;  command &#34;/usr/bin/my_great_command&#34;&#10;end&#10;&#10;every 1.day, :at =&#62; &#39;4:30 am&#39; do&#10;  runner &#34;MyModel.task_to_run_at_four_thirty_in_the_morning&#34;&#10;end&#10;&#10;every :hour do # Many shortcuts available: :hour, :day, :month, :year, :reboot&#10;  runner &#34;SomeModel.ladeeda&#34;&#10;end&#10;&#10;every :sunday, :at =&#62; &#39;12pm&#39; do # Use any day of the week or :weekend, :weekday&#10;  runner &#34;Task.do_something_great&#34;&#10;end&#10;&#10;every &#39;0 0 27-31 * *&#39; do&#10;  command &#34;echo &#39;you can use raw cron syntax too&#39;&#34;&#10;end&#10;&#10;# run this task only on servers with the :app role in Capistrano&#10;# see Capistrano roles section below&#10;every :day, :at =&#62; &#39;12:20am&#39;, :roles =&#62; [:app] do&#10;  rake &#34;app_server:task&#34;&#10;end</span><br></pre></td></tr></table></figure>
<h3 id="定义自己的工作类型">定义自己的工作类型</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">job_type :awesome, &#39;/usr/local/bin/awesome :task :fun_level&#39;&#10;&#10;every 2.hours do&#10;  awesome &#34;party&#34;, :fun_level =&#62; &#34;extreme&#34;&#10;end</span><br></pre></td></tr></table></figure>
<h3 id="whenever_默认的工作类型与定义">whenever 默认的工作类型与定义</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">job_type :command, &#34;:task :output&#34;&#10;job_type :rake,    &#34;cd :path &#38;&#38; :environment_variable=:environment bundle exec rake :task --silent :output&#34;&#10;job_type :runner,  &#34;cd :path &#38;&#38; script/rails runner -e :environment &#39;:task&#39; :output&#34;&#10;job_type :script,  &#34;cd :path &#38;&#38; :environment_variable=:environment bundle exec script/:task :output&#34;</span><br></pre></td></tr></table></figure>
<h3 id="RVM_集成">RVM 集成</h3><p>…</p>
<h3 id="Capistrano_集成">Capistrano 集成</h3><p>…</p>
<h3 id="资料">资料</h3><p><a href="http://zh.wikipedia.org/wiki/Cron" target="_blank" rel="external">What is Cron</a></p>
<p><a href="http://huacnlee.com/blog/create-rails-task-scheduler-by-rake-and-cronjob/" target="_blank" rel="external">Rake + cronjob 创建计划任务</a></p>
<p><a href="http://railscasts.com/episodes/164-cron-in-ruby" target="_blank" rel="external">164-cron-in-ruby</a></p>

    
  </div>
  <footer class="end-sep">
    
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <a href="/tech-2013-01-03-centos-offline-install-ruby-environment/">
  <time datetime="2013-01-03T07:43:00.000Z">
    2013-01-03
  </time>
</a>
    
    
  
    <h1 class="title"><a href="/tech-2013-01-03-centos-offline-install-ruby-environment/">CentOS 5.6 离线安装Ruby环境及配置项目</a></h1>
  

  </header>
  
  <div class="entry">
    
      <p>遇到了这么个小问题，需要把完成的railsApp打包到CentOS上，而且服务器不能联网，<br>ruby 环境也没有安装。一番捣鼓，步骤如下:</p>
<p><strong>没有找到离线安装rvm的方法 而且 linux版本为CentOS 5.6</strong></p>
<h3 id="下载源文件">下载源文件</h3><p><a href="http://ftp.ruby-lang.org/pub/ruby/1.9/ruby-1.9.3-p327.tar.gz" target="_blank" rel="external">ruby-1.9.3-p327</a></p>
<p><a href="http://pyyaml.org/download/libyaml/yaml-0.1.4.tar.gz" target="_blank" rel="external">yaml-0.1.4.tar.gz</a></p>
<p><a href="http://rubygems.org/downloads/bundler-1.2.3.gem" target="_blank" rel="external">bundler-1.2.3</a></p>
<h3 id="本地服务器">本地服务器</h3><h4 id="打包_rails_app">打包 rails app</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ bundle package&#10;#&#33509;&#25552;&#31034;&#27809;&#26377;,&#23433;&#35013;bundler&#24182;&#37325;&#22797;&#20197;&#19978;&#27493;&#39588;&#10;$ gem install bundler&#10;$ bundle package # &#23558;&#39033;&#30446;&#25152;&#38656;&#35201;&#30340;gem&#22797;&#21046;&#21040; vendor/cache&#10;$ tar -czf   railsApp.tar.gz   railsApp #&#21387;&#32553;&#25171;&#21253;</span><br></pre></td></tr></table></figure>
<h3 id="远程服务器">远程服务器</h3><h4 id="首先安装_yaml-0-1-4-tar-gz，再安装ruby"><strong>首先安装 yaml-0.1.4.tar.gz，再安装ruby</strong></h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ tar &#8211;xzvf  yaml-0.1.4.tar.gz&#10;$ ./configure&#10;$ make&#10;$ make install</span><br></pre></td></tr></table></figure>
<h4 id="安装ruby">安装ruby</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ tar  -xzvf  ruby-1.9.3-p327.tar.gz&#10;$ cd ruby-1.9.3-p327&#10;$ ./configure&#10;$ make&#10;$ make install&#10;$ ruby -v   #&#25552;&#31034;&#21363;&#23433;&#35013;&#25104;&#21151;&#10;$ gem -v    #gem&#24050;&#32463;&#23433;&#35013;</span><br></pre></td></tr></table></figure>
<h4 id="本地安装bundler">本地安装bundler</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ gem install  bundler-1.2.3.gem&#10;$ bundle -v  #&#25552;&#31034;&#21363;&#23433;&#35013;&#25104;&#21151;</span><br></pre></td></tr></table></figure>
<h4 id="部署_rails_app">部署 rails app</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ tar  -xzvf  railsApp.tar.gz&#10;$ cd railsApp&#10;$ bundle install --local  #&#26412;&#22320;&#23433;&#35013;gem</span><br></pre></td></tr></table></figure>
<p><strong>注意修改配置文件</strong></p>
<pre><code><span class="variable">$ </span>rails s  <span class="comment">#测试运行</span>
</code></pre><p> <a href="https://gist.github.com/4274057" target="_blank" rel="external">分享在gist上</a></p>

    
  </div>
  <footer class="end-sep">
    
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <a href="/tech-2013-01-01-goodbye-2012-hello-2013/">
  <time datetime="2013-01-01T08:43:00.000Z">
    2013-01-01
  </time>
</a>
    
    
  
    <h1 class="title"><a href="/tech-2013-01-01-goodbye-2012-hello-2013/">再见2012, 你好2013</a></h1>
  

  </header>
  
  <div class="entry">
    
      <p>当我还在2011憧憬2012的时候，它走到了末尾，迎来了2013，时间走的好快。</p>
<p>~~说好的末日没有来，爱情也木来 ~~</p>
<p>换了新的工作，换了新的同事。</p>
<p>自从11年11月份接触ruby，至今也有1年多了。感觉进步不是很快，一直是一个人摸爬滚打，<br>没有真正的引路人。</p>
<h2 id="To_Do_List">To Do List</h2><h3 id="Rails">Rails</h3><p>Rails测试框架<br>基本定性在已 RSpec+factory_girl为基础的测试框架，以后逐步添加其他gem。<br>测试效率，覆盖率，自动程度，学习难度，这几个方面考虑。</p>
<h3 id="Git">Git</h3><p>这么潮的版本控制工具，不用实在不是我性格。<br>等比对了Git跟svn的优缺点，我就要转型了。</p>
<h3 id="论坛">论坛</h3><p>计划推迟了很长时间</p>
<h3 id="提高英语水平">提高英语水平</h3><p>感觉我的水平就停留在了初中人教版，看这么多文档，费时费力，懂英语会走的更远。</p>
<h3 id="Python">Python</h3><p>python算是ruby的兄弟语言。虽没有ruby那么灵活，但运行速度快，跨平台性好。<br>GUI方面比ruby强了很多。java语法太琐碎了，概念性的东西一大堆。</p>
<h3 id="mac_mini">mac mini</h3><p>虽然在ubuntu基本可以胜任，但在GUI方面还是mac支持的不错。<br>公司也不提供工作的电脑，整天扛着笔记本挤地铁，有些痛苦。<br>到时候可以研究下ios，当作副业，开发个app，弄点小钱也不错。</p>
<h3 id="ruby_on_arduino">ruby on arduino</h3><p>看见别人分享的ppt，感觉很新奇，很潮。<br>软件跟硬件打交道，这是最能直观体现软件价值功能的地方了。</p>
<p>arduino在<a href="http://arduino.tw/" target="_blank" rel="external">tw</a>很火。</p>
<p><a href="http://zh.wikipedia.org/wiki/Arduino" target="_blank" rel="external">中文wiki</a></p>
<p><a href="http://www.arduino.cc/" target="_blank" rel="external">arduino官网</a></p>
<h3 id="多赚钱">多赚钱</h3><p>money才是王道啊</p>
<hr>
<p>补录: 这本是在13年1月1号发出来的，竟然拖到了13年12月21号。</p>
<p>我在13年12月20号整理了blog，当天晚上外祖父突然去世，愿您安息！</p>

    
  </div>
  <footer class="end-sep">
    
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <a href="/tech-2012-09-15-the-ruby-syntax-yield-and-closure/">
  <time datetime="2012-09-14T18:06:00.000Z">
    2012-09-15
  </time>
</a>
    
    
  
    <h1 class="title"><a href="/tech-2012-09-15-the-ruby-syntax-yield-and-closure/">ruby的yield和闭包</a></h1>
  

  </header>
  
  <div class="entry">
    
      <p><strong>First Blood</strong>  来些血腥凶残暴力的！<br>这些经常在面试中被提问，内容很多。<br>从面试里单独拿出来，这东西相当于神器级别，必须谨慎对待。</p>
<p>yield是ruby中一个特殊的关键字，可以调用块方法(block)，而block是ruby闭包的一种，<br>故将三者联系起来，yeild天生就是闭包的小跟班儿。感觉没必要单独讲，不然很割裂的赶脚。</p>
<h3 id="ruby_闭包_block，Proc，lambda"><strong> ruby 闭包</strong>   block，Proc，lambda</h3><p><strong>block 与 yield</strong><br>block 是最常用到的，有两种形式,{}和do … end。<br>一般单行习惯用{}，多行用do … end，当然这只是习惯。</p>
<figure class="highlight ruby"><figcaption><span>demo.rb</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_yield</span></span></span><br><span class="line">  <span class="keyword">yield</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">test_yield&#123; puts <span class="string">"this is first block."</span> &#125; <span class="comment"># yield可以调用block 即&#123;...&#125;</span></span><br><span class="line"></span><br><span class="line">test_yield <span class="keyword">do</span></span><br><span class="line">  puts <span class="string">"this is second block."</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test2_yield</span></span></span><br><span class="line">  <span class="keyword">yield</span>(<span class="string">"shooter"</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">test2_yield&#123; |var| puts <span class="string">"This args is <span class="subst">#&#123;var&#125;</span>."</span> &#125;</span><br><span class="line"><span class="comment">#传给yield的参数(此处为shooter)即对应了block中的参数(||中的部分)</span></span><br></pre></td></tr></table></figure>
<p>还可以通过 Kernel#block_given? 方法询问当前的方法调用是否包含块。<br><figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span></span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">yield</span> <span class="keyword">if</span> block_given?</span><br><span class="line">  puts <span class="string">'no block'</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">test <span class="comment"># =&gt; no block</span></span><br><span class="line">test&#123; puts <span class="string">"Here's a block"</span> &#125; <span class="comment"># =&gt; Here's a block</span></span><br></pre></td></tr></table></figure></p>
<p><strong>Proc对象</strong></p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">plus = <span class="constant">Proc</span>.new &#123; |x| x + <span class="number">1</span> &#125;</span><br><span class="line">puts plus.call(<span class="number">2</span>) <span class="comment"># =&gt;3</span></span><br><span class="line"></span><br><span class="line">subtract = proc &#123; |x| x - <span class="number">1</span> &#125;</span><br><span class="line">puts subtract.call(<span class="number">4</span>) <span class="comment"># =&gt;3</span></span><br></pre></td></tr></table></figure>
<p>这被称为<strong>延迟执行</strong>(Defferred Evaluation)。</p>
<p>通过<strong>&amp;操作符</strong>，block 与 Proc对象可以相互转化。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def math_one(a, b, &#38;oper)&#10;  puts yield(a,b)&#10;end&#10;&#10;def math_two(a, b, &#38;oper)&#10;  puts oper.call(a,b)&#10;end&#10;&#10;math_one(2,3) &#123; |x,y| x + y&#125; # =&#62; 2 + 3 = 5&#10;math_two(2,3) &#123; |x,y| x * y&#125; # =&#62; 2 * 3 = 6</span><br></pre></td></tr></table></figure>
<p>那么这个&amp;起了什么作用？<br><figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_method</span><span class="params">(&amp;code)</span></span></span><br><span class="line">  code</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">p = my_method&#123; |name| <span class="string">"Hello,<span class="subst">#&#123;name&#125;</span>!"</span>&#125;</span><br><span class="line">puts p.<span class="keyword">class</span> <span class="comment"># =&gt; Proc</span></span><br><span class="line">puts p.call(<span class="string">"shooter"</span>) <span class="comment"># =&gt; Hello,shooter!</span></span><br></pre></td></tr></table></figure></p>
<p>&amp;操作符的真正含义：Proc对象和块之间的切换符号。&amp;code是一个块，code是一个Proc对象。<br>简单的去掉&amp;操作符，我们就能再次得到一个Proc对象。<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def proc_to_block(greeting)&#10;  puts &#34;#&#123;greeting&#125;,#&#123;yield&#125;&#34;&#10;end&#10;&#10;my_proc = Proc.new &#123;&#34;shooter!&#34;&#125;&#10;puts my_proc.class&#10;proc_to_block(&#34;Hello&#34;, &#38;my_proc)</span><br></pre></td></tr></table></figure></p>
<p><strong>lambda函数</strong><br>lambda跟Proc就像两个双胞胎<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">plus = lambda &#123; |x| x + 1 &#125;&#10;puts plus.call(2) # =&#62;3</span><br></pre></td></tr></table></figure></p>
<p>lambda跟Proc有两个最明显的区别: <br></p>
<ol>
<li>lambda检查参数的个数，Proc不会。<br><br>&nbsp;在Proc中，多余的参数被设为nil。但lambda中，Ruby会抛出一个ArgumentError错误。<br></li>
<li>return不同。<br><br>&nbsp;lambda的return是返回值给方法，方法会继续执行。Proc的return会终止方法并返回得到的值。<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def proc_return&#10;  Proc.new &#123; return &#34;Proc.new&#34;&#125;.call&#10;  return &#34;proc_return method finished&#34;&#10;end&#10;&#10;def lambda_return&#10;  lambda &#123; return &#34;lambda&#34; &#125;.call&#10;  return &#34;lambda_return method finished&#34;&#10;end&#10;&#10;puts proc_return    # =&#62; Proc.new&#10;puts lambda_return # =&#62; lambda_return method finished</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>看了代码会一目了然。参考了不少资料，就是拼凑的起来的。</p>

    
  </div>
  <footer class="end-sep">
    
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <a href="/tech-2012-09-05-interview-questions-about-the-ror/">
  <time datetime="2012-09-04T17:30:00.000Z">
    2012-09-05
  </time>
</a>
    
    
  
    <h1 class="title"><a href="/tech-2012-09-05-interview-questions-about-the-ror/">RoR的一些面试经验(一)</a></h1>
  

  </header>
  
  <div class="entry">
    
      <p> 那些天我不是在面试，就是在面试的路上，搞得很懈怠，主要还是精神上的。<br> 有的中规中矩;有的问题很琐碎;有的很BT,概念性的东西一股闹的全抛出来了……<br> 我记性不太好，对概念不感冒，倒不是从小这样，记得当年还背过视力表，<br> 可能三聚氰胺喝多了吧。</p>
<h3 id="Symbol与String">Symbol与String</h3><p>在rails中经常看到Symbol，像 <figure class="highlight"><figcaption><span>:email params[:user]```，</span></figcaption><table><tr><td class="code"><pre><span class="line">&#36825;&#31181;&#24050;:&#24320;&#22836;&#30340;&#21464;&#37327;&#23601;&#26159;Symbol&#23545;&#35937;&#12290;&#35980;&#20284;&#25105;&#32463;&#24120;&#25226;&#20004;&#32773;&#28151;&#29992;&#65292;&#36824;&#26377;&#20123;&#19981;&#21516;&#30340;&#12290;&#10;&#10;**&#21019;&#24314; symbol &#23545;&#35937;**</span><br></pre></td></tr></table></figure></p>
<p> :foo<br> :”shooter”<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#10;&#22312; Ruby &#20013;&#27599;&#19968;&#20010;&#23545;&#35937;&#37117;&#26377;&#21807;&#19968;&#30340;&#23545;&#35937;&#26631;&#35782;&#31526;&#65288;Object Identifier&#65289;&#65292;&#21487;&#20197;&#36890;&#36807; object_id &#26041;&#27861;&#26469;&#24471;&#21040;&#19968;&#20010;&#23545;&#35937;&#30340;&#26631;&#35782;&#31526;&#12290;</span><br></pre></td></tr></table></figure></p>
<p>1.9.3p194 :001 &gt; 3.times{ puts :foo.object_id }<br>230808<br>230808<br>230808<br> =&gt; 3<br>1.9.3p194 :002 &gt; 3.times{ puts “foo”.object_id }<br>85823400<br>85823380<br>85823350<br> =&gt; 3<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#19968;&#20010;&#23383;&#31526;&#20018;&#27599;&#20986;&#29616;&#19968;&#27425; Ruby &#23601;&#20250;&#21019;&#24314;&#19968;&#20010; String&#23545;&#35937;&#65292;&#21363;&#20415;&#20182;&#20204;&#21253;&#21547;&#20102;&#30456;&#21516;&#30340;&#23383;&#31526;&#20018;&#20869;&#23481;&#65307;&#10;&#32780;&#23545;&#20110; Symbol &#23545;&#35937;&#65292;&#19968;&#20010;&#21517;&#23383;&#65288;&#23383;&#31526;&#20018;&#20869;&#23481;&#65289;&#21807;&#19968;&#30830;&#23450;&#19968;&#20010; Symbol &#23545;&#35937;&#12290;&#10;Symbol &#23545;&#35937;&#19968;&#26086;&#23450;&#20041;&#23558;&#19968;&#30452;&#23384;&#22312;&#65292;&#20320;&#19981;&#33021;&#23545;symbol&#36171;&#20540;&#65292;&#10;&#32780;&#19988;&#22312;&#36816;&#34892;&#29615;&#22659;&#20013;symbol&#30340;&#20540;&#20063;&#19981;&#20250;&#25913;&#21464;&#65292;&#30452;&#21040;&#31243;&#24207;&#25191;&#34892;&#36864;&#20986;&#12290;&#10;&#10;**&#30456;&#20114;&#36716;&#21270;**</span><br></pre></td></tr></table></figure></p>
<h1 id="Symbol到String">Symbol到String</h1><p>1.9.3p194 :001 &gt; :foo.id2name<br> =&gt; “foo”<br>1.9.3p194 :002 &gt; :foo.to_s<br> =&gt; “foo”<br>1.9.3p194 :003 &gt; :”I am a rubyist”<br> =&gt; :”I am a rubyist”</p>
<h1 id="String到Symbol">String到Symbol</h1><p>1.9.3p194 :004 &gt; “rubyist”.to_sym<br> =&gt; :rubyist<br>1.9.3p194 :005 &gt; “rubyist”.intern<br> =&gt; :rubyist<br>```</p>
<p>从实用角度看，在一些场景下Symbol好过String只有两点：<strong>节省内存，表达简洁</strong> <br><br>通常来讲，当你面临 String 还是 Symbol 的选择时，可以参考以下标准：<br><br>&nbsp;&nbsp;如果使用字符串的内容，这个内容可能会变化，使用 String <br><br>&nbsp;&nbsp;如果使用固定的名字或者说是标识符，使用 Symbol。</p>
<p>这是第一篇，没想到一个内容就这么多，再写东西就有些多了，果断阉割了。</p>

    
  </div>
  <footer class="end-sep">
    
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


  

  <nav id="pagination">
  
    <a href="/archives/page/5/" class="prev">上一页</a>
  
  
    <a href="/archives/page/7/" class="next">下一页</a>
  
  <div class="clearfix"></div>
</nav>

</div>
  </div>
  <footer id="footer"><div class="copyright">
  
  &copy; 2016 <a href="/">shooter</a>
  
</div>
<div class="theme-copyright">
  Theme by <a href="https://github.com/orderedlist" target="_blank">orderedlist</a>
   | 
  Redesign by <a href="http://heroicyang.com/" target="_blank">Heroic Yang</a>
</div>
<div class="clearfix"></div></footer>
  <script src="//cdn.staticfile.org/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/scale.fix.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<script type="text/javascript">
  var disqus_shortname = 'shooterme';

  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  }());
</script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
  (function($){
    $('.fancybox').fancybox();
  })(jQuery);
</script>

<script type="text/javascript">
  (function(){
    var infos = new Object();

    infos['qq'] ='1458643975';
    infos['mobile'] ='18612621540';
    infos['extend'] ='\\u90b9\\u5029\\u96ef';

    console.log(infos);
  })();
</script>


</body>
</html>